---
title: "R4ds Exercises"
author: "Darin Stephenson"
date: "6/3/2021"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
require("knitr")
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir=normalizePath("..")) #set working directory to the project directory
library(conflicted)
library(tidyverse)
library(nycflights13)
conflict_prefer("select", "dplyr")
conflict_prefer("lag", "dplyr")
conflict_prefer("filter", "dplyr")
```

```{r}
print(dim(filter(flights,arr_delay > 120)))
print(dim(filter(flights,dest == "IAH" | dest == "HOU")))
print(dim(filter(flights,carrier == "AA" | carrier == "UA" | carrier == "DL")))
print(dim(filter(flights,between(month,7,9))))
print(dim(filter(flights,arr_delay > 120 & dep_delay <= 0)))
print(dim(filter(flights,dep_delay >= 60 & (dep_delay-arr_delay) > 30)))
print(dim(filter(flights,dep_time <= 600)))
print(dim(filter(flights,is.na(dep_time))))
print(dim(filter(flights,is.na(arr_time & !is.na(dep_time)))))
missing_dep_time <- filter(flights,is.na(dep_time))
missing_arr_time <- filter(flights,is.na(arr_time & !is.na(dep_time)))
```

```{r}
arrange(flights,!is.na(dep_delay),desc(dep_delay))
```

```{r}
flights <- mutate(flights,
                  dep_time_min = 60*dep_time %/% 100 + dep_time %% 100,
                  sched_dep_time_min = 60*sched_dep_time %/% 100 + sched_dep_time %% 100,
                  arr_time_min = 60*arr_time %/% 100 + arr_time %% 100,
                  sched_arr_time_min = 60*sched_arr_time %/% 100 + sched_arr_time %% 100)
```


```{r}
flights <- mutate(flights,
                  arr_dep_diff = arr_time_min - dep_time_min,
                  delay_rank= min_rank(arr_delay)) %>%
  arrange(delay_rank)
```


```{r}
by_dest <- group_by(flights, dest)
delay <- summarise(by_dest,
  count = n(),
  dist = mean(distance, na.rm = TRUE),
  delay = mean(arr_delay, na.rm = TRUE)
)
delay <- filter(delay, count > 20, dest != "HNL")

ggplot(data = delay, mapping = aes(x = dist, y = delay)) +
  geom_point(aes(size = count), alpha = 1/3) +
  geom_smooth(se = FALSE)
```
